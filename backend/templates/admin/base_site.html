{% extends "admin/base.html" %}
{% load static i18n admin_urls admin_list %}

{# ---------------- NAV SIDEBAR ---------------- #}
{% block nav-sidebar %}
  {% if available_apps %}
    {% include "admin/nav_sidebar.html" with app_list=available_apps %}
  {% else %}
    {% include "admin/nav_sidebar.html" with app_list=app_list %}
  {% endif %}
{% endblock %}

{# ---------------- USER TOOLS (TOP RIGHT) ---------------- #}
{% block usertools %}
<div id="header-tools" class="user-tools">

  {{ block.super }}

  {# ðŸ”” Notification Bell #}
  <a href="{% url 'admin-notifications' %}"
     id="admin-noti-link"
     style="margin-left:12px; position:relative; display:inline-flex; align-items:center;">

    <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true">
      <path d="M12 22a2 2 0 0 0 2-2H10a2 2 0 0 0 2 2zm6-6v-5a6 6 0 1 0-12 0v5l-2 2v1h16v-1l-2-2z"
            fill="currentColor"/>
    </svg>

    <span id="admin-noti-badge"
          style="
            display:none;
            min-width:16px;
            padding:0 5px;
            font-size:11px;
            line-height:16px;
            background:#dc2626;
            color:#fff;
            border-radius:10px;
            position:absolute;
            top:-6px;
            right:-10px;
            text-align:center;
          ">
      0
    </span>
  </a>

</div>
{% endblock %}

{# ---------------- EXTRA HEAD (CSS + JS) ---------------- #}
{% block extrahead %}
{{ block.super }}

<style>
  /* Brand styling */
  #site-name,
  #site-name a,
  #site-name .brand-name {
    color: #fff !important;
  }

  .brand-logo {
    height: 22px;
    vertical-align: middle;
    margin-right: 6px;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function () {

    async function refreshNotiCount() {
      try {
        const res = await fetch(
          "{% url 'admin-notifications-count' %}",
          { credentials: 'same-origin' }
        );
        if (!res.ok) return;

        const data = await res.json();
        const badge = document.getElementById('admin-noti-badge');

        if (!badge) return;

        const count = data.count || 0;
        badge.textContent = count;

        badge.style.display = count > 0 ? 'inline-block' : 'none';
      } catch (e) {
        console.error("Notification count error:", e);
      }
    }

    refreshNotiCount();
    setInterval(refreshNotiCount, 30000); // refresh every 30 seconds
  });
</script>
{% endblock %}

{# ---------------- BRANDING ---------------- #}
{% block branding %}
<h1 id="site-name" class="site-name">
  <a href="{% url 'admin:index' %}">
    <img src="{% static 'a.png' %}" alt="JobSeeker" class="brand-logo">
    <span class="brand-name">JobSeeker Admin</span>
  </a>
</h1>
{% endblock %}
